	SUBROUTINE DCHOLS(A,M,IERR)
C
C...PURPOSE: DOUBLE PRECISION CHOLESKI MATRIX INVERSION
C...CODE FROM THE COMMON NUMERICAL ALGORITHM SET OF VISUAL FORTRAN 2002 
C...MODIFIED  2020
C
       IMPLICIT REAL *8 (A-H,O-Z)
	 DIMENSION A(M,M)
!	 DIMENSION B(M,M),X(M),S(M)
	 DIMENSION B(1000,1000),X(1000),S(1000)


	  IERR=0
C
C	SCALE MATRIX
C
	  DO 300 I=1,M
C
	  SUM=A(I,I)
	  IF(SUM.LE.0.D0) GO TO 400
	S(I)=1.D0/DSQRT(A(I,I))
 300	CONTINUE
	  DO 301 I=1,M
	  DO 3010 J=1,M
	  A(I,J)=A(I,J)*S(I)*S(J)
 3010	CONTINUE
 301  CONTINUE
C
	  DO 100 I=1,M
	  SUM=A(I,I)
	  IF(I.EQ.1) GO TO 10
	  DO 101 K=1,I-1
	  SUM=SUM -B(K,I)**2
 101	CONTINUE
 10	  IF(SUM.LE.0.D0) GO TO 400
	  B(I,I)=DSQRT(SUM)
	  IF(I.EQ.M) GO TO 100
	  DO 102 J=I+1,M
	  SUM=A(J,I)
	  IF(I.EQ.1) GO TO 11
	  DO 103 K=1,I-1
	  SUM=SUM -B(K,I)*B(K,J)
 103	CONTINUE
 11	  B(I,J)=SUM/B(I,I)
 102	CONTINUE
 100	CONTINUE
C
C
	  DO 200 I=1,M
	  DO 206 J=1,M
 206	X(J)=0.D0
	  X(I)=1.D0
	  DO 202 J=1,M
	  SUM=X(J)
	  IF(J.EQ.1) GO TO 20
	  DO 203 K=1,J-1
	  SUM=SUM -B(K,J)*X(K)
 203	CONTINUE
 20	  X(J)=SUM/B(J,J)
 202	CONTINUE
	  DO 204 J=1,M
	  M1=M -J +1
	  SUM=X(M1)
	  IF(J.EQ.1) GO TO 21
	  DO 205 K=1,J-1
	  M2=M -K +1
	  SUM=SUM -B(M1,M2)*X(M2)
 205	CONTINUE
 21	  CONTINUE
	  X(M1)=SUM/B(M1,M1)
 204	CONTINUE
	  DO 22 J=1,M
 22	  A(J,I)=X(J)
 200	CONTINUE
C
C	UNSCALE MATRIX
C
	  DO 302 I=1,M
	  DO 3020 J=1,M
	  A(I,J)=A(I,J)*S(I)*S(J)
 3020	    CONTINUE
 302	CONTINUE
	  RETURN
 400	CONTINUE
	  IERR=0
	  RETURN
	  END



